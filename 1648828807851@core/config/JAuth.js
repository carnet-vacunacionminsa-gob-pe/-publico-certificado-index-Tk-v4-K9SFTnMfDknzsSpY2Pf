import{JRequest}from"../http/JRequest.js";import{JMsg}from"../popups/JMsg.js";import{JPreload}from"../util/JGeneral.js";import{JConst}from"./JConst.js";let instance=null;export class JAuth{constructor(){null===window.sessionStorage.getItem("jaAuthCVCK")?(this.oUser=null,this.signOff()):(this.oUser=JSON.parse(window.localStorage.getItem("jaAuthCV")),this.ubigeos=JSON.parse(window.localStorage.getItem("ubigeos")))}static get(){return null==instance&&(instance=new this),instance}setAccess(e){window.sessionStorage.setItem("jaAuthCVCK",!0),this.oUser=window.localStorage.setItem("jaAuthCV",JSON.stringify(e))}setUbigeos(e){window.localStorage.setItem("ubigeos",JSON.stringify(e))}getUbigeos(){return this.ubigeos}getData(){return this.oUser}getAccess(e){return null===this.oUser||void 0===this.oUser?null:this.oUser[e]?this.oUser[e]:null}isActive(){return null!==this.oUser&&void 0!==this.oUser||(this.signOff(),!1)}signOff(){window.localStorage.removeItem("jaAuthCV"),window.sessionStorage.removeItem("jaAuthCVCK")}static api(e,t=!0){return{post:function(o,s){return JRequest.Post(!0===t?JConst.UrlApi(e):e,o||{},"json","json",[{key:"Authorization",value:"Bearer "+(void 0!==s?s:JAuth.get().getAccess("Token"))}]).catch((e=>(JMsg.clearAll(),JPreload.hideBody(),401===e.status?(JAuth.get().signOff(),JMsg.alert("La consulta a los datos no est치 permitido o su tiempo de sesi칩n activa ha expirado. Favor de volver a ingresar.").run().then((e=>document.location.href=JConst.UrlBase()))):JMsg.notice().show("Vuelve a intentarlo",!0),null)))},get:function(){return JRequest.Get(!0===t?JConst.UrlApi(e):e,"json").catch((e=>{let t=document.getElementById("jaAlertaPq");return t&&(t.style.display="block",t.innerHTML="Error: "+e),null}))},form:function(t,o){return JRequest.Post(JConst.UrlApi(e),t,"form","json",[{key:"Authorization",value:"Bearer "+(void 0!==o?o:JAuth.get().getAccess("Token"))}])}}}static apiSolicitude(e,t=!0){return{post:function(o,s){return JRequest.Post(!0===t?JConst.UrlApiSolicitude(e):e,o||{},"json","json",[{key:"Authorization",value:"Bearer "+(void 0!==s?s:JAuth.get().getAccess("Token"))}]).catch((e=>(JMsg.clearAll(),JPreload.hideBody(),401===e.status?(JAuth.get().signOff(),JMsg.alert("La consulta a los datos no est치 permitido o su tiempo de sesi칩n activa ha expirado. Favor de volver a ingresar.").run().then((e=>document.location.href=JConst.UrlBase()))):JMsg.notice().show("Vuelve a intentarlo",!0),null)))},get:function(){return JRequest.Get(!0===t?JConst.UrlApiSolicitude(e):e,"json").catch((e=>{let t=document.getElementById("jaAlertaPq");return t&&(t.style.display="block",t.innerHTML="Error: "+e),null}))},ubigeo:function(o){return JRequest.Get(!0===t?JConst.UrlApiSolicitude(e):e,"json",[{key:"Authorization",value:"Bearer "+(void 0!==o?o:JAuth.get().getAccess("Token"))}]).catch((e=>{let t=document.getElementById("jaAlertaPq");return t&&(t.style.display="block",t.innerHTML="Error: "+e),null}))},form:function(o,s){return JRequest.Post(!0===t?JConst.UrlApiSolicitude(e):e,o,"form","json")}}}}